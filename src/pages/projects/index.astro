---
import Layout from '../../layouts/Layout.astro';
import StatusBadge from '../../components/StatusBadge.astro';
import { getCollection } from 'astro:content';
import { getUrl } from '../../utils/url';

const projects = await getCollection('projects');
// Sort by date desc
projects.sort((a, b) => new Date(b.data.publishDate).valueOf() - new Date(a.data.publishDate).valueOf());
---

<Layout title="Projects - My Portfolio">
	<div class="max-w-4xl mx-auto">
		<h1 class="text-3xl font-bold mb-8">Projects</h1>
		<div class="grid gap-8">
			{projects.map((project) => (
				<article class="bg-white dark:bg-mono-900 border border-mono-200 dark:border-mono-800 rounded-lg p-6 hover:shadow-lg transition-shadow">
					<div class="flex flex-col md:flex-row md:items-start md:justify-between">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-2">
                <StatusBadge status={project.data.status} />
                <h2 class="text-2xl font-bold">
                  <a href={getUrl(`/projects/${project.slug}`)} class="hover:underline decoration-mono-500 underline-offset-4">
                    {project.data.title}
                  </a>
                </h2>
              </div>
              <p class="text-mono-600 dark:text-mono-400 mb-4 line-clamp-3">
                {project.data.description}
              </p>
              <div class="flex flex-wrap gap-2">
                {project.data.tags?.map((tag) => (
                  <span class="text-xs font-medium px-2.5 py-0.5 rounded bg-mono-100 dark:bg-mono-800 text-mono-800 dark:text-mono-200">
                    #{tag}
                  </span>
                ))}
              </div>
              <div class="flex flex-col gap-1 mt-4 pt-4 border-t border-mono-100 dark:border-mono-800">
                 <time class="text-sm text-mono-500">{new Date(project.data.publishDate).toLocaleDateString()}</time>
                 <a href={getUrl(`/projects/${project.slug}`)} class="text-sm font-semibold text-mono-900 dark:text-mono-100 hover:text-mono-600 dark:hover:text-mono-300">
                   Read more â†’
                 </a>
              </div>
            </div>
            {project.data.heroImage && (
              <div class="mt-4 md:mt-0 md:ml-6 flex-shrink-0 w-full md:w-48 self-stretch">
                 <img src={getUrl(project.data.heroImage)} alt={project.data.title} class="w-full h-full object-cover rounded-lg border border-mono-200 dark:border-mono-800" />
              </div>
            )}
					</div>
				</article>
			))}
		</div>
	</div>
</Layout>
